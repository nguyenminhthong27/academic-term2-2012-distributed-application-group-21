<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html class="cufon-active cufon-ready" xmlns="http://www.w3.org/11001/xhtml" dir="ltr" lang="en-US"><head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>Notes on MongoDB, GridFS, sharding  and deploying in the cloud | Viktor Petersson.com</title>

<link rel="stylesheet" href="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/style.css" type="text/css" media="screen">
<link rel="alternate" type="application/rss+xml" title="Viktor Petersson.com RSS Feed" href="http://viktorpetersson.com/feed/">
<link rel="alternate" type="application/atom+xml" title="Viktor Petersson.com Atom Feed" href="http://viktorpetersson.com/feed/atom/">
<link rel="pingback" href="http://viktorpetersson.com/xmlrpc.php">


	<link rel="alternate" type="application/rss+xml" title="Viktor Petersson.com » Notes on MongoDB, GridFS, sharding  and deploying in the cloud Comments Feed" href="http://viktorpetersson.com/2012/01/29/notes-on-mongodb-gridfs-and-sharding-in-the-cloud/feed/">
<link rel="stylesheet" id="flickr-gallery-css" href="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/flickr-gallery.css" type="text/css" media="all">
<link rel="stylesheet" id="fg-jquery-ui-css" href="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/jquery-ui-1.css" type="text/css" media="all">
<link rel="stylesheet" id="jquery-flightbox-css" href="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/jquery.css" type="text/css" media="all">
<link rel="stylesheet" id="tfg_style-css" href="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/tfg_style.css" type="text/css" media="all">
<link rel="stylesheet" id="NextGEN-css" href="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/nggallery.css" type="text/css" media="screen">
<link rel="stylesheet" id="shutter-css" href="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/shutter-reloaded.css" type="text/css" media="screen">
<link rel="stylesheet" id="contact-form-7-css" href="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/styles.css" type="text/css" media="all">
<script async="" src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/cbgapi.loaded_0"></script><script type="text/javascript" src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/jquery.js"></script>
<script type="text/javascript" src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/jquery_002.js"></script>
<script type="text/javascript" src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/widgets.js"></script>
<script gapi_processed="true" type="text/javascript" src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/plusone.js"></script>
<script type="text/javascript" src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/in.js"></script><script src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/nonSecureAnonymousFramework"></script>
<script type="text/javascript" src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/pinit.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var shutterSettings = {"msgLoading":"L O A D I N G","msgClose":"Click to Close","imageCount":"1"};
/* ]]> */
</script>
<script type="text/javascript" src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/shutter-reloaded.js"></script>
<script type="text/javascript" src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/swfobject.js"></script>
<script type="text/javascript" src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/comment-reply.js"></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://viktorpetersson.com/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://viktorpetersson.com/wp-includes/wlwmanifest.xml"> 
<link rel="prev" title="Countries and coffee consumption." href="http://viktorpetersson.com/2012/01/28/countries-and-coffee-consumption/">
<link rel="next" title="Introducing the brand new YippieMove" href="http://viktorpetersson.com/2012/01/31/introducing-the-brand-new-yippiemove/">
<meta name="generator" content="WordPress 3.3.2">
<link rel="shortlink" href="http://viktorpetersson.com/?p=1154">

<!-- All in One SEO Pack 1.6.14.3 by Michael Torbert of Semper Fi Web Design[296,395] -->
<meta name="keywords" content="mongodb">
<link rel="canonical" href="http://viktorpetersson.com/2012/01/29/notes-on-mongodb-gridfs-and-sharding-in-the-cloud/">
<!-- /all in one seo pack -->
<link type="text/css" rel="stylesheet" href="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/easy-chart-builder.css"><!-- <meta name="NextGEN" version="1.9.3" /> -->


<!-- Facebook Like Thumbnail -->
<link rel="image_src" href="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/primary_secondary_arbiter.png">
<!-- End Facebook Like Thumbnail -->

<link rel="stylesheet" type="text/css" href="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/recaptcha.css">
<link rel="stylesheet" href="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/wp-syntax.css" type="text/css" media="screen">
<link id="MediaRSS" rel="alternate" type="application/rss+xml" title="NextGEN Gallery RSS Feed" href="http://viktorpetersson.com/wp-content/plugins/nextgen-gallery/xml/media-rss.php">
			<script type="text/javascript">
				var get_sizes = null;
							</script>
		
	<script type="text/javascript" src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/jquery-1.js"></script>
	<script type="text/javascript" src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/ie6_script.js"></script>
	
	<script type="text/javascript" src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/cufon-yui.js"></script><style type="text/css">cufon{text-indent:0!important;}@media screen,projection{cufon{display:inline!important;display:inline-block!important;position:relative!important;vertical-align:middle!important;font-size:1px!important;line-height:1px!important;}cufon cufontext{display:-moz-inline-box!important;display:inline-block!important;width:0!important;height:0!important;overflow:hidden!important;text-indent:-10000in!important;}cufon canvas{position:relative!important;}}@media print{cufon{padding:0!important;}cufon canvas{display:none!important;}}</style>
	<script type="text/javascript" src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/cufon-replace.js"></script>
	
	<script type="text/javascript" src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/Swis721_Th_BT_400.js"></script>
	
	<script type="text/javascript" src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/drop-down-menu.js"></script>

<script src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/embed.js" async="" type="text/javascript"></script><script charset="UTF-8" async="" src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/thread.js"></script><link href="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/defaults.css" type="text/css" rel="stylesheet"><script charset="UTF-8" async="" src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/disqus.js"></script><style type="text/css">* html #li_ui_li_gen_1336809981509_0 a#li_ui_li_gen_1336809981509_0-link{height:1% !important;}#li_ui_li_gen_1336809981509_0{position:relative !important;overflow:visible !important;display:block !important;}#li_ui_li_gen_1336809981509_0 a#li_ui_li_gen_1336809981509_0-link{border:0 !important;height:20px !important;text-decoration:none !important;padding:0 !important;margin:0 !important;display:inline-block !important;}#li_ui_li_gen_1336809981509_0 a#li_ui_li_gen_1336809981509_0-link:link, #li_ui_li_gen_1336809981509_0 a#li_ui_li_gen_1336809981509_0-link:visited, #li_ui_li_gen_1336809981509_0 a#li_ui_li_gen_1336809981509_0-link:hover, #li_ui_li_gen_1336809981509_0 a#li_ui_li_gen_1336809981509_0-link:active{border:0 !important;text-decoration:none !important;}#li_ui_li_gen_1336809981509_0 a#li_ui_li_gen_1336809981509_0-link:after{content:"." !important;display:block !important;clear:both !important;visibility:hidden !important;line-height:0 !important;height:0 !important;}#li_ui_li_gen_1336809981509_0 #li_ui_li_gen_1336809981509_0-logo{background:url(http://static02.linkedin.com/scds/common/u/img/sprite/sprite_connect_v13.png) 0px -276px no-repeat !important;cursor:pointer !important;border:0 !important;text-indent:-9999em !important;overflow:hidden !important;padding:0 !important;margin:0 !important;position:absolute !important;left:0px !important;top:0px !important;display:block !important;width:20px !important;height:20px !important;float:right !important;}#li_ui_li_gen_1336809981509_0.hovered #li_ui_li_gen_1336809981509_0-logo{background-position:-20px -276px !important;}#li_ui_li_gen_1336809981509_0.clicked #li_ui_li_gen_1336809981509_0-logo, #li_ui_li_gen_1336809981509_0.down #li_ui_li_gen_1336809981509_0-logo{background-position:-40px -276px !important;}.IN-shadowed #li_ui_li_gen_1336809981509_0 #li_ui_li_gen_1336809981509_0-logo{}#li_ui_li_gen_1336809981509_0 #li_ui_li_gen_1336809981509_0-title{color:#333 !important;cursor:pointer !important;display:block !important;white-space:nowrap !important;float:left !important;margin-left:1px !important;vertical-align:top !important;overflow:hidden !important;text-align:center !important;height:18px !important;padding:0 4px 0 23px !important;border:1px solid #000 !important;border-top-color:#E2E2E2 !important;border-right-color:#BFBFBF !important;border-bottom-color:#B9B9B9 !important;border-left-color:#E2E2E2 !important;border-left:0 !important;text-shadow:#FFFFFF -1px 1px 0 !important;line-height:20px !important;border-radius:0 !important;-moz-border-radius:0 !important;border-top-right-radius:2px !important;border-bottom-right-radius:2px !important;-moz-border-radius-topright:2px !important;-moz-border-radius-bottomright:2px !important;background-color:#ECECEC !important;background-image:-moz-linear-gradient(top, #FEFEFE 0%, #ECECEC 100%) !important;}#li_ui_li_gen_1336809981509_0.hovered #li_ui_li_gen_1336809981509_0-title{border:1px solid #000 !important;border-top-color:#ABABAB !important;border-right-color:#9A9A9A !important;border-bottom-color:#787878 !important;border-left-color:#04568B !important;border-left:0 !important;background-color:#EDEDED !important;background-image:-moz-linear-gradient(top, #EDEDED 0%, #DEDEDE 100%) !important;}#li_ui_li_gen_1336809981509_0.clicked #li_ui_li_gen_1336809981509_0-title, #li_ui_li_gen_1336809981509_0.down #li_ui_li_gen_1336809981509_0-title{color:#666 !important;border:1px solid #000 !important;border-top-color:#B6B6B6 !important;border-right-color:#B3B3B3 !important;border-bottom-color:#9D9D9D !important;border-left-color:#49627B !important;border-left:0 !important;background-color:#DEDEDE !important;background-image:-moz-linear-gradient(top, #E3E3E3 0%, #EDEDED 100%) !important;}.IN-shadowed #li_ui_li_gen_1336809981509_0 #li_ui_li_gen_1336809981509_0-title{}.IN-shadowed #li_ui_li_gen_1336809981509_0.hovered #li_ui_li_gen_1336809981509_0-title{}.IN-shadowed #li_ui_li_gen_1336809981509_0.clicked #li_ui_li_gen_1336809981509_0-title, .IN-shadowed #li_ui_li_gen_1336809981509_0.down #li_ui_li_gen_1336809981509_0-title{}#li_ui_li_gen_1336809981509_0 #li_ui_li_gen_1336809981509_0-title-text, #li_ui_li_gen_1336809981509_0 #li_ui_li_gen_1336809981509_0-title-text *{color:#333 !important;font-size:11px !important;font-family:Arial, sans-serif !important;font-weight:bold !important;font-style:normal !important;display:inline-block !important;background:transparent none !important;vertical-align:baseline !important;height:18px !important;line-height:20px !important;float:none !important;}#li_ui_li_gen_1336809981509_0 #li_ui_li_gen_1336809981509_0-title-text strong{font-weight:bold !important;}#li_ui_li_gen_1336809981509_0 #li_ui_li_gen_1336809981509_0-title-text em{font-style:italic !important;}#li_ui_li_gen_1336809981509_0.hovered #li_ui_li_gen_1336809981509_0-title-text, #li_ui_li_gen_1336809981509_0.hovered #li_ui_li_gen_1336809981509_0-title-text *{color:#000 !important;}#li_ui_li_gen_1336809981509_0.clicked #li_ui_li_gen_1336809981509_0-title-text, #li_ui_li_gen_1336809981509_0.down #li_ui_li_gen_1336809981509_0-title-text, #li_ui_li_gen_1336809981509_0.clicked #li_ui_li_gen_1336809981509_0-title-text *, #li_ui_li_gen_1336809981509_0.down #li_ui_li_gen_1336809981509_0-title-text *{color:#666 !important;}#li_ui_li_gen_1336809981509_0 #li_ui_li_gen_1336809981509_0-title #li_ui_li_gen_1336809981509_0-mark{display:inline-block !important;width:0px !important;overflow:hidden !important;}.success #li_ui_li_gen_1336809981509_0 #li_ui_li_gen_1336809981509_0-title{color:#333 !important;border-top-color:#E2E2E2 !important;border-right-color:#BFBFBF !important;border-bottom-color:#B9B9B9 !important;border-left-color:#E2E2E2 !important;background-color:#ECECEC !important;background-image:-moz-linear-gradient(top, #FEFEFE 0%, #ECECEC 100%) !important;}.success #li_ui_li_gen_1336809981509_0 #li_ui_li_gen_1336809981509_0-title-text, .success #li_ui_li_gen_1336809981509_0 #li_ui_li_gen_1336809981509_0-title-text *{color:#333 !important;}.IN-shadowed .success #li_ui_li_gen_1336809981509_0 #li_ui_li_gen_1336809981509_0-title{}.success #li_ui_li_gen_1336809981509_0.hovered #li_ui_li_gen_1336809981509_0-title{color:#000 !important;border-top-color:#ABABAB !important;border-right-color:#9A9A9A !important;border-bottom-color:#787878 !important;border-left-color:#04568B !important;background-color:#EDEDED !important;background-image:-moz-linear-gradient(top, #EDEDED 0%, #DEDEDE 100%) !important;}.success #li_ui_li_gen_1336809981509_0.hovered #li_ui_li_gen_1336809981509_0-title-text, .success #li_ui_li_gen_1336809981509_0.hovered #li_ui_li_gen_1336809981509_0-title-text *{color:#000 !important;}.success #li_ui_li_gen_1336809981509_0.clicked #li_ui_li_gen_1336809981509_0-title, .success #li_ui_li_gen_1336809981509_0.down #li_ui_li_gen_1336809981509_0-title{color:#666 !important;border-top-color:#B6B6B6 !important;border-right-color:#B3B3B3 !important;border-bottom-color:#9D9D9D !important;border-left-color:#49627B !important;background-color:#DEDEDE !important;background-image:-moz-linear-gradient(top, #E3E3E3 0%, #EDEDED 100%) !important;}.success #li_ui_li_gen_1336809981509_0.clicked #li_ui_li_gen_1336809981509_0-title-text, .success #li_ui_li_gen_1336809981509_0.down #li_ui_li_gen_1336809981509_0-title-text, .success #li_ui_li_gen_1336809981509_0.clicked #li_ui_li_gen_1336809981509_0-title-text *, .success #li_ui_li_gen_1336809981509_0.down #li_ui_li_gen_1336809981509_0-title-text *{color:#666 !important;}.IN-shadowed .success #li_ui_li_gen_1336809981509_0.clicked #li_ui_li_gen_1336809981509_0-title, .IN-shadowed .success #li_ui_li_gen_1336809981509_0.down #li_ui_li_gen_1336809981509_0-title{}#li_ui_li_gen_1336809981531_1-container.IN-right {display:inline-block !important;float:left !important;overflow:visible !important;position:relative !important;height:18px !important;padding-left:2px !important;line-height:1px !important;cursor:pointer !important;}#li_ui_li_gen_1336809981531_1.IN-right {display:block !important;float:left !important;height:18px !important;margin-right:4px !important;padding-right:4px !important;background:url(http://static02.linkedin.com/scds/common/u/img/sprite/sprite_connect_v13.png) right -100px no-repeat !important;}#li_ui_li_gen_1336809981531_1-inner.IN-right {display:block !important;float:left !important;padding-left:8px !important;text-align:center !important;background:url(http://static02.linkedin.com/scds/common/u/img/sprite/sprite_connect_v13.png) 0px -60px no-repeat !important;}#li_ui_li_gen_1336809981531_1-content.IN-right {display:inline !important;font-size:11px !important;color:#04558B !important;font-weight:bold !important;font-family:Arial, sans-serif !important;line-height:18px !important;padding:0 5px 0 5px !important;}#li_ui_li_gen_1336809981531_1-container.IN-hovered #li_ui_li_gen_1336809981531_1.IN-right, #li_ui_li_gen_1336809981531_1-container.IN-clicked #li_ui_li_gen_1336809981531_1.IN-right, #li_ui_li_gen_1336809981531_1-container.IN-down #li_ui_li_gen_1336809981531_1.IN-right {background-position-y:-120px !important;}#li_ui_li_gen_1336809981531_1-container.IN-hovered #li_ui_li_gen_1336809981531_1-inner.IN-right, #li_ui_li_gen_1336809981531_1-container.IN-clicked #li_ui_li_gen_1336809981531_1-inner.IN-right, #li_ui_li_gen_1336809981531_1-container.IN-down #li_ui_li_gen_1336809981531_1-inner.IN-right {background-position-y:-80px !important;}#li_ui_li_gen_1336809981531_1-container.IN-empty {display:none !important;}#li_ui_li_gen_1336809981531_1-container.IN-hidden #li_ui_li_gen_1336809981531_1 {display:none !important;}</style><link href="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/theme.css" type="text/css" rel="stylesheet"><script charset="UTF-8" async="" src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/theme.js"></script><script charset="UTF-8" async="" src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/all.js"></script><style type="text/css">.fb_hidden{position:absolute;top:-10000px;z-index:10001}
.fb_invisible{display:none}
.fb_reset{background:none;border-spacing:0;border:0;color:#000;cursor:auto;direction:ltr;font-family:"lucida grande", tahoma, verdana, arial, sans-serif;font-size:11px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal}
.fb_link img{border:none}
.fb_dialog{background:rgba(82, 82, 82, .7);position:absolute;top:-10000px;z-index:10001}
.fb_dialog_advanced{padding:10px;-moz-border-radius:8px;-webkit-border-radius:8px}
.fb_dialog_content{background:#fff;color:#333}
.fb_dialog_close_icon{background:url(http://static.ak.fbcdn.net/rsrc.php/v1/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 0 transparent;_background-image:url(http://static.ak.fbcdn.net/rsrc.php/v1/yL/r/s816eWC-2sl.gif);cursor:pointer;display:block;height:15px;position:absolute;right:18px;top:17px;width:15px;top:8px\9;right:7px\9}
.fb_dialog_mobile .fb_dialog_close_icon{top:5px;left:5px;right:auto}
.fb_dialog_padding{background-color:transparent;position:absolute;width:1px;z-index:-1}
.fb_dialog_close_icon:hover{background:url(http://static.ak.fbcdn.net/rsrc.php/v1/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -15px transparent;_background-image:url(http://static.ak.fbcdn.net/rsrc.php/v1/yL/r/s816eWC-2sl.gif)}
.fb_dialog_close_icon:active{background:url(http://static.ak.fbcdn.net/rsrc.php/v1/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -30px transparent;_background-image:url(http://static.ak.fbcdn.net/rsrc.php/v1/yL/r/s816eWC-2sl.gif)}
.fb_dialog_loader{background-color:#f2f2f2;border:1px solid #606060;font-size:24px;padding:20px}
.fb_dialog_top_left,
.fb_dialog_top_right,
.fb_dialog_bottom_left,
.fb_dialog_bottom_right{height:10px;width:10px;overflow:hidden;position:absolute}
.fb_dialog_top_left{background:url(http://static.ak.fbcdn.net/rsrc.php/v1/ye/r/8YeTNIlTZjm.png) no-repeat 0 0;left:-10px;top:-10px}
.fb_dialog_top_right{background:url(http://static.ak.fbcdn.net/rsrc.php/v1/ye/r/8YeTNIlTZjm.png) no-repeat 0 -10px;right:-10px;top:-10px}
.fb_dialog_bottom_left{background:url(http://static.ak.fbcdn.net/rsrc.php/v1/ye/r/8YeTNIlTZjm.png) no-repeat 0 -20px;bottom:-10px;left:-10px}
.fb_dialog_bottom_right{background:url(http://static.ak.fbcdn.net/rsrc.php/v1/ye/r/8YeTNIlTZjm.png) no-repeat 0 -30px;right:-10px;bottom:-10px}
.fb_dialog_vert_left,
.fb_dialog_vert_right,
.fb_dialog_horiz_top,
.fb_dialog_horiz_bottom{position:absolute;background:#525252;filter:alpha(opacity=70);opacity:.7}
.fb_dialog_vert_left,
.fb_dialog_vert_right{width:10px;height:100%}
.fb_dialog_vert_left{margin-left:-10px}
.fb_dialog_vert_right{right:0;margin-right:-10px}
.fb_dialog_horiz_top,
.fb_dialog_horiz_bottom{width:100%;height:10px}
.fb_dialog_horiz_top{margin-top:-10px}
.fb_dialog_horiz_bottom{bottom:0;margin-bottom:-10px}
.fb_dialog_iframe{line-height:0}
.fb_dialog_content .dialog_title{background:#6d84b4;border:1px solid #3b5998;color:#fff;font-size:14px;font-weight:bold;margin:0}
.fb_dialog_content .dialog_title > span{background:url(http://static.ak.fbcdn.net/rsrc.php/v1/yd/r/Cou7n-nqK52.gif)
no-repeat 5px 50%;float:left;padding:5px 0 7px 26px}
body.fb_hidden{-webkit-transform:none;height:100%;margin:0;left:-10000px;overflow:visible;position:absolute;top:-10000px;width:100%
}
.fb_dialog.fb_dialog_mobile.loading{background:url(http://static.ak.fbcdn.net/rsrc.php/v1/yO/r/_j03izEX40U.gif)
white no-repeat 50% 50%;min-height:100%;min-width:100%;overflow:hidden;position:absolute;top:0;z-index:10001}
.fb_dialog.fb_dialog_mobile.loading.centered{max-height:590px;min-height:590px;max-width:500px;min-width:500px}
#fb-root #fb_dialog_ipad_overlay{background:rgba(0, 0, 0, .45);position:absolute;left:0;top:0;width:100%;min-height:100%;z-index:10000}
#fb-root #fb_dialog_ipad_overlay.hidden{display:none}
.fb_dialog.fb_dialog_mobile.loading iframe{visibility:hidden}
.fb_dialog_content .dialog_header{-webkit-box-shadow:white 0 1px 1px -1px inset;background:-webkit-gradient(linear, 0 0, 0 100%, from(#738ABA), to(#2C4987));border-bottom:1px solid;border-color:#1d4088;color:#fff;font:14px Helvetica, sans-serif;font-weight:bold;text-overflow:ellipsis;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0;vertical-align:middle;white-space:nowrap}
.fb_dialog_content .dialog_header table{-webkit-font-smoothing:subpixel-antialiased;height:43px;width:100%
}
.fb_dialog_content .dialog_header td.header_left{font-size:12px;padding-left:5px;vertical-align:middle;width:60px
}
.fb_dialog_content .dialog_header td.header_right{font-size:12px;padding-right:5px;vertical-align:middle;width:60px
}
.fb_dialog_content .touchable_button{background:-webkit-gradient(linear, 0 0, 0 100%, from(#4966A6),
color-stop(0.5, #355492), to(#2A4887));border:1px solid #29447e;-webkit-background-clip:padding-box;-webkit-border-radius:3px;-webkit-box-shadow:rgba(0, 0, 0, .117188) 0 1px 1px inset,
rgba(255, 255, 255, .167969) 0 1px 0;display:inline-block;margin-top:3px;max-width:85px;line-height:18px;padding:4px 12px;position:relative}
.fb_dialog_content .dialog_header .touchable_button input{border:none;background:none;color:#fff;font:12px Helvetica, sans-serif;font-weight:bold;margin:2px -12px;padding:2px 6px 3px 6px;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}
.fb_dialog_content .dialog_header .header_center{color:#fff;font-size:16px;font-weight:bold;line-height:18px;text-align:center;vertical-align:middle}
.fb_dialog_content .dialog_content{background:url(http://static.ak.fbcdn.net/rsrc.php/v1/y9/r/jKEcVPZFk-2.gif) no-repeat 50% 50%;border:1px solid #555;border-bottom:0;border-top:0;height:150px}
.fb_dialog_content .dialog_footer{background:#f2f2f2;border:1px solid #555;border-top-color:#ccc;height:40px}
#fb_dialog_loader_close{float:left}
.fb_dialog.fb_dialog_mobile .fb_dialog_close_button{text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}
.fb_dialog.fb_dialog_mobile .fb_dialog_close_icon{visibility:hidden}
.fb_iframe_widget{position:relative;display:-moz-inline-block;display:inline-block}
.fb_iframe_widget iframe{position:absolute}
.fb_iframe_widget_lift{z-index:1}
.fb_iframe_widget span{position:relative;display:inline-block;vertical-align:text-bottom;text-align:justify}
.fb_hide_iframes iframe{position:relative;left:-10000px}
.fb_iframe_widget_loader{position:relative;display:inline-block}
.fb_iframe_widget_fluid{display:inline}
.fb_iframe_widget_loader iframe{min-height:32px;z-index:2;zoom:1}
.fb_iframe_widget_loader .FB_Loader{background:url(http://static.ak.fbcdn.net/rsrc.php/v1/y9/r/jKEcVPZFk-2.gif) no-repeat;height:32px;width:32px;margin-left:-16px;position:absolute;left:50%;z-index:4}
.fb_button_simple,
.fb_button_simple_rtl{background-image:url(http://static.ak.fbcdn.net/rsrc.php/v1/yH/r/eIpbnVKI9lR.png);background-repeat:no-repeat;cursor:pointer;outline:none;text-decoration:none}
.fb_button_simple_rtl{background-position:right 0}
.fb_button_simple .fb_button_text{margin:0 0 0 20px;padding-bottom:1px}
.fb_button_simple_rtl .fb_button_text{margin:0 10px 0 0}
a.fb_button_simple:hover .fb_button_text,
a.fb_button_simple_rtl:hover .fb_button_text,
.fb_button_simple:hover .fb_button_text,
.fb_button_simple_rtl:hover .fb_button_text{text-decoration:underline}
.fb_button,
.fb_button_rtl{background:#29447e url(http://static.ak.fbcdn.net/rsrc.php/v1/yL/r/FGFbc80dUKj.png);background-repeat:no-repeat;cursor:pointer;display:inline-block;padding:0 0 0 1px;text-decoration:none;outline:none}
.fb_button .fb_button_text,
.fb_button_rtl .fb_button_text{background:#5f78ab url(http://static.ak.fbcdn.net/rsrc.php/v1/yL/r/FGFbc80dUKj.png);border-top:solid 1px #879ac0;border-bottom:solid 1px #1a356e;color:#fff;display:block;font-family:"lucida grande",tahoma,verdana,arial,sans-serif;font-weight:bold;padding:2px 6px 3px 6px;margin:1px 1px 0 21px;text-shadow:none}
a.fb_button,
a.fb_button_rtl,
.fb_button,
.fb_button_rtl{text-decoration:none}
a.fb_button:active .fb_button_text,
a.fb_button_rtl:active .fb_button_text,
.fb_button:active .fb_button_text,
.fb_button_rtl:active .fb_button_text{border-bottom:solid 1px #29447e;border-top:solid 1px #45619d;background:#4f6aa3;text-shadow:none}
.fb_button_xlarge,
.fb_button_xlarge_rtl{background-position:left -60px;font-size:24px;line-height:30px}
.fb_button_xlarge .fb_button_text{padding:3px 8px 3px 12px;margin-left:38px}
a.fb_button_xlarge:active{background-position:left -99px}
.fb_button_xlarge_rtl{background-position:right -268px}
.fb_button_xlarge_rtl .fb_button_text{padding:3px 8px 3px 12px;margin-right:39px}
a.fb_button_xlarge_rtl:active{background-position:right -307px}
.fb_button_large,
.fb_button_large_rtl{background-position:left -138px;font-size:13px;line-height:16px}
.fb_button_large .fb_button_text{margin-left:24px;padding:2px 6px 4px 6px}
a.fb_button_large:active{background-position:left -163px}
.fb_button_large_rtl{background-position:right -346px}
.fb_button_large_rtl .fb_button_text{margin-right:25px}
a.fb_button_large_rtl:active{background-position:right -371px}
.fb_button_medium,
.fb_button_medium_rtl{background-position:left -188px;font-size:11px;line-height:14px}
a.fb_button_medium:active{background-position:left -210px}
.fb_button_medium_rtl{background-position:right -396px}
.fb_button_text_rtl,
.fb_button_medium_rtl .fb_button_text{padding:2px 6px 3px 6px;margin-right:22px}
a.fb_button_medium_rtl:active{background-position:right -418px}
.fb_button_small,
.fb_button_small_rtl{background-position:left -232px;font-size:10px;line-height:10px}
.fb_button_small .fb_button_text{padding:2px 6px 3px;margin-left:17px}
a.fb_button_small:active,
.fb_button_small:active{background-position:left -250px}
.fb_button_small_rtl{background-position:right -440px}
.fb_button_small_rtl .fb_button_text{padding:2px 6px;margin-right:18px}
a.fb_button_small_rtl:active{background-position:right -458px}
.fb_share_count_wrapper{position:relative;float:left}
.fb_share_count{background:#b0b9ec none repeat scroll 0 0;color:#333;font-family:"lucida grande", tahoma, verdana, arial, sans-serif;text-align:center}
.fb_share_count_inner{background:#e8ebf2;display:block}
.fb_share_count_right{margin-left:-1px;display:inline-block}
.fb_share_count_right .fb_share_count_inner{border-top:solid 1px #e8ebf2;border-bottom:solid 1px #b0b9ec;margin:1px 1px 0 1px;font-size:10px;line-height:10px;padding:2px 6px 3px;font-weight:bold}
.fb_share_count_top{display:block;letter-spacing:-1px;line-height:34px;margin-bottom:7px;font-size:22px;border:solid 1px #b0b9ec}
.fb_share_count_nub_top{border:none;display:block;position:absolute;left:7px;top:35px;margin:0;padding:0;width:6px;height:7px;background-repeat:no-repeat;background-image:url(http://static.ak.fbcdn.net/rsrc.php/v1/yU/r/bSOHtKbCGYI.png)}
.fb_share_count_nub_right{border:none;display:inline-block;padding:0;width:5px;height:10px;background-repeat:no-repeat;background-image:url(http://static.ak.fbcdn.net/rsrc.php/v1/yX/r/i_oIVTKMYsL.png);vertical-align:top;background-position:right 5px;z-index:10;left:2px;margin:0 2px 0 0;position:relative}
.fb_share_no_count{display:none}
.fb_share_size_Small .fb_share_count_right .fb_share_count_inner{font-size:10px}
.fb_share_size_Medium .fb_share_count_right .fb_share_count_inner{font-size:11px;padding:2px 6px 3px;letter-spacing:-1px;line-height:14px}
.fb_share_size_Large .fb_share_count_right .fb_share_count_inner{font-size:13px;line-height:16px;padding:2px 6px 4px;font-weight:normal;letter-spacing:-1px}
.fb_share_count_hidden .fb_share_count_nub_top,
.fb_share_count_hidden .fb_share_count_top,
.fb_share_count_hidden .fb_share_count_nub_right,
.fb_share_count_hidden .fb_share_count_right{visibility:hidden}
.fb_connect_bar_container div,
.fb_connect_bar_container span,
.fb_connect_bar_container a,
.fb_connect_bar_container img,
.fb_connect_bar_container strong{background:none;border-spacing:0;border:0;direction:ltr;font-style:normal;font-variant:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal;vertical-align:baseline}
.fb_connect_bar_container{position:fixed;left:0 !important;right:0 !important;height:42px !important;padding:0 25px !important;margin:0 !important;vertical-align:middle !important;border-bottom:1px solid #333 !important;background:#3b5998 !important;z-index:99999999 !important;overflow:hidden !important}
.fb_connect_bar_container_ie6{position:absolute;top:expression(document.compatMode=="CSS1Compat"? document.documentElement.scrollTop+"px":body.scrollTop+"px")}
.fb_connect_bar{position:relative;margin:auto;height:100%;width:100%;padding:6px 0 0 0 !important;background:none;color:#fff !important;font-family:"lucida grande", tahoma, verdana, arial, sans-serif !important;font-size:13px !important;font-style:normal !important;font-variant:normal !important;font-weight:normal !important;letter-spacing:normal !important;line-height:1 !important;text-decoration:none !important;text-indent:0 !important;text-shadow:none !important;text-transform:none !important;white-space:normal !important;word-spacing:normal !important}
.fb_connect_bar a:hover{color:#fff}
.fb_connect_bar .fb_profile img{height:30px;width:30px;vertical-align:middle;margin:0 6px 5px 0}
.fb_connect_bar div a,
.fb_connect_bar span,
.fb_connect_bar span a{color:#bac6da;font-size:11px;text-decoration:none}
.fb_connect_bar .fb_buttons{float:right;margin-top:7px}
.fb_edge_widget_with_comment{position:relative;*z-index:1000}
.fb_edge_widget_with_comment span.fb_edge_comment_widget{position:absolute}
.fb_edge_widget_with_comment span.fb_send_button_form_widget{z-index:1}
.fb_edge_widget_with_comment span.fb_send_button_form_widget .FB_Loader{left:0;top:1px;margin-top:6px;margin-left:0;background-position:50% 50%;background-color:#fff;height:150px;width:394px;border:1px #666 solid;border-bottom:2px solid #283e6c;z-index:1}
.fb_edge_widget_with_comment span.fb_send_button_form_widget.dark .FB_Loader{background-color:#000;border-bottom:2px solid #ccc}
.fb_edge_widget_with_comment span.fb_send_button_form_widget.siderender
.FB_Loader{margin-top:0}
.fbpluginrecommendationsbarleft,
.fbpluginrecommendationsbarright{position:fixed !important;bottom:0;z-index:999}
/* @noflip */
.fbpluginrecommendationsbarleft{left:10px}
/* @noflip */
.fbpluginrecommendationsbarright{right:10px}
</style><script charset="UTF-8" async="" src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/event.js"></script></head><body data-twttr-rendered="true">

	<div class="main">
		<div class="main-bg">
			
			<div class="tail-right"></div>
		
			<div class="main-width">
				
				<div class="content"><div class="content-bg">
			
					<!--header-->
					<div class="header">
				
						<div class="logo">
							<div class="indent">
								<h1 onclick="location.href='http://viktorpetersson.com/'">Viktor Petersson.com</h1>
							</div>
						</div>
						
						<div class="main-menu">
							
							<div id="dropmenu">
								<div class="menu"><ul><li><a href="http://viktorpetersson.com/" title="Home">Home</a></li><li class="page_item page-item-85"><a href="http://viktorpetersson.com/consulting/">Consulting</a></li><li class="page_item page-item-911"><a href="http://viktorpetersson.com/contact/">Contact</a></li><li class="page_item page-item-22"><a href="http://viktorpetersson.com/open-source/">Open Source</a></li><li class="page_item page-item-178"><a href="http://viktorpetersson.com/portfolio/">Portfolio</a></li><li class="page_item page-item-8"><a href="http://viktorpetersson.com/resume/">Resume</a></li></ul></div>
							</div>
							
						</div>
						
					</div>
					
					<!--/ header-->
					
					<!--column-right-->
<div class="column-right">

			
		<!-- Author information is disabled per default. Uncomment and fill in your details if you want to use it.
			<li><h2>Author</h2>
			<p>A little something about you, the author. Nothing lengthy, just an overview.</p>
		</li>
		-->
			
	<div class="follow"><a href="http://twitter.com/vpetersson"><img alt="" src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/twitter.png"></a><a href="http://www.facebook.com/vpetersson"><img alt="" src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/facebook.png"></a><a href="http://www.linkedin.com/in/vpetersson"><img alt="" src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/linkedin.png"></a></div>
	
		<div id="text-3" class="widget widget_text"><div class="widget-bg"><div class="indent">			<div class="textwidget"><iframe src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/vpetersson.htm" style="border: 0pt none;" allowtransparency="true" frameborder="0" height="59px" scrolling="no" width="120px"></iframe></div>
				</div></div></div>			<div id="recent-posts-3" class="widget widget_recent_entries"><div class="widget-bg"><div class="indent">				<div class="title"><div><div><h2>Latest Posts		</h2></div></div></div>		<ul>
				<li><a href="http://viktorpetersson.com/2012/05/07/deploying-freebsds-ports-to-a-large-number-of-nodes/" title="Deploying FreeBSD’s Ports to a large number of nodes">Deploying FreeBSD’s Ports to a large number of nodes</a></li>
				<li><a href="http://viktorpetersson.com/2012/04/14/monitor-memcached-with-munin-on-ubuntu/" title="Monitor Memcached with Munin (on Ubuntu)">Monitor Memcached with Munin (on Ubuntu)</a></li>
				<li><a href="http://viktorpetersson.com/2012/03/24/im-interviewed-by-city-network/" title="I’m interviewed by City Network">I’m interviewed by City Network</a></li>
				<li><a href="http://viktorpetersson.com/2012/03/09/how-to-quickly-slice-wallpapers-for-dual-screens/" title="How to quickly slice wallpapers for a dual-screen setup">How to quickly slice wallpapers for a dual-screen setup</a></li>
				<li><a href="http://viktorpetersson.com/2012/02/27/the-pg_ha-project-has-moved-to-github/" title="The ‘pg_ha’ project has moved to Github">The ‘pg_ha’ project has moved to Github</a></li>
				</ul>
				</div></div></div>	<div id="twitter" class="widget widget_Twidget"><div class="widget-bg"><div class="indent"><div id="twitter_div">		<div class="title"><div><div><h2>Latest Tweets		</h2></div></div></div><ul id="twitter_update_list"><li><span>How is this not generating a larger public outcry? <a href="http://t.co/ufwtRg48">http://t.co/ufwtRg48</a></span> <a style="font-size: 85%;" href="http://twitter.com/vpetersson/statuses/199958855109718016">3 days ago</a></li><li><span>Just found a really handy tool to verify SSL-certificates: <a href="http://t.co/3jYVR9mE">http://t.co/3jYVR9mE</a></span> <a style="font-size: 85%;" href="http://twitter.com/vpetersson/statuses/199903909546954752">3 days ago</a></li><li><span>What. The. Fuck. Apple. <a href="http://t.co/jfAqztTl">http://t.co/jfAqztTl</a></span> <a style="font-size: 85%;" href="http://twitter.com/vpetersson/statuses/199241582518611969">5 days ago</a></li><li><span>Well, this is somewhat embarrassing for Yahoo <a href="http://t.co/RblcaCEI">http://t.co/RblcaCEI</a></span> <a style="font-size: 85%;" href="http://twitter.com/vpetersson/statuses/198165444140597249">8 days ago</a></li><li><span>Finally! @<a href="http://twitter.com/spotify">spotify</a> just launched an iPad version.</span> <a style="font-size: 85%;" href="http://twitter.com/vpetersson/statuses/197962145697239040">8 days ago</a></li><li><span>.@<a href="http://twitter.com/slevenbits">slevenbits</a> and I have spent the past 3 hours cleaning injections from @<a href="http://twitter.com/wordpress">wordpress</a> and then hardening it. Not super exciting.</span> <a style="font-size: 85%;" href="http://twitter.com/vpetersson/statuses/197433796658864128">10 days ago</a></li><li><span><a href="http://t.co/mF8YFsOD">http://t.co/mF8YFsOD</a></span> <a style="font-size: 85%;" href="http://twitter.com/vpetersson/statuses/197032957955940353">11 days ago</a></li><li><span>At CDG in Paris. French people are world champions at inefficiency. They've perfected the art. The DMV is far behind.</span> <a style="font-size: 85%;" href="http://twitter.com/vpetersson/statuses/196533996707000320">12 days ago</a></li></ul></div>
		      <script type="text/javascript" src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/blogger.js"></script><script type="text/javascript" src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/vpetersson.json"></script>		</div></div></div>
</div><!--/ column-right-->

<!--column-center-->
<div class="column-center">

									<br>
					<div class="navigation navsingle">
						<div class="alignleft">&lt;&lt;<a href="http://viktorpetersson.com/2012/01/28/countries-and-coffee-consumption/" rel="prev">Countries and coffee consumption.</a></div>
						<div class="alignright"><a href="http://viktorpetersson.com/2012/01/31/introducing-the-brand-new-yippiemove/" rel="next">Introducing the brand new YippieMove</a>&gt;&gt;</div>
						
					</div>
					
					<div class="post-1154 post type-post status-publish format-standard hentry category-howto tag-mongodb" id="post-1154">
						
						<div class="indent bgnone" style=" padding-top:15px;">
							
							
							<div class="title">
						
								<h2>Notes on MongoDB, GridFS, sharding  and deploying in the cloud</h2>

								<div class="link-edit"></div>
								
								<div class="date">
									<span>January 29, 2012 5:24 am</span> &nbsp;&nbsp; Posted by <a href="http:///" title="Visit Viktor Petersson’s website" rel="external">Viktor Petersson</a> &nbsp;&nbsp; <a href="http://viktorpetersson.com/2012/01/29/notes-on-mongodb-gridfs-and-sharding-in-the-cloud/#comments" title="Comment on Notes on MongoDB, GridFS, sharding  and deploying in the cloud"><span class="dsq-postid" rel="1154 http://viktorpetersson.com/?p=1154">Comments (4)</span></a>
								</div>
								
							</div>
							
							<div class="text-box">
								
								<p class="img"></p>
								<p><a href="http://wireload.net/">We</a>‘ve been using MongoDB in production for about six months with <a href="http://www.yippiemove.com/">YippieMove</a>. It’s been an interesting experience and we’ve learned a lot. </p>
<p>Contrary to many MongoDB deployments, we primarily use it for storing
 files in GridFS. We switched over to MongoDB after searching for a good
 distributed file system for years. Prior to MongoDB we used a regular 
NFS share, sitting on top of a <a href="http://viktorpetersson.com/2010/09/27/setting-up-a-redundant-nas-with-hast-with-carp/">HAST</a>-device. That worked great, but it didn’t allow us to scale horizontally the way a distributed file system allows. </p>
<p>Enter MongoDB. Just like most people playing around with MongoDB, we started out with a simple <a href="http://www.mongodb.org/display/DOCS/Replica+Sets">Replica Set</a>, but are now in the process of switching to a sharded setup. </p>
<p>In the post, I will go over some of the things we’ve learned when using MongoDB.<br>
<span id="more-1154"></span> </p>
<h2>Running MongoDB in the Cloud</h2>
<p>One major thing to keep in mind when deploying MongoDB is that it 
matters a lot if you are deploying in a public cloud or on dedicated 
server. We deployed in a public cloud. While we did get good performance
 compared to many other cloud vendors, the performance were of course 
not at par with beefy dedicated servers (but came with other benefits 
instead). </p>
<p>The biggest constrain with running in the cloud is limited I/O 
performance. We get about 60-80MB/s in writes, and 80-100MB/s in reads 
from our disks. That isn’t super fast for something like MongoDB, and we
 need to keep that in mind when we design the architecture. </p>
<p>When we started out, we started with a replica set with three members
 (Primary + 2x Secondary). That worked well initially, and it felt good 
knowing that all data was backed up 3x. The problem however was that 
during heavy load, we saw that the secondary nodes fell behind. If the 
heavy load lasted long, the secondary nodes fell far behind such that 
they fell out of the opsize, and hence couldn’t catch up. </p>
<p>To cope with this, we changed our strategy a bit and turned one of 
the secondaries into an arbiter. That offloaded the primary server 
significantly. If one were to run with dedicated servers on beefy 
hardware, I do not think this would be an issue at all. This was 
primarily due to the low I/O performance, and a cloud-specific issue.</p>
<p>The setup we ended up then with was as follows:</p>
<p><img alt="" src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/primary_secondary_arbiter.png" title="Primary, Secondary and Arbiter" class="aligncenter"></p>
<h2>Replica Set</h2>
<p>Setting up a Replica Set with MongoDB is very straight forward. It is
 recommended that you use three servers for a replica set. Two of which 
should be more or less dedicated to MongoDB, while the third is the 
arbiter, and can run on another server that isn’t necessarily dedicated 
to MongoDB. The arbiter isn’t resource intense, and is only used to keep
 track of the other two servers and vote for which one should be the 
primary.</p>
<p>The process of setting up a replica set is simple and the instructions can be found <a href="http://www.mongodb.org/display/DOCS/Replica+Set+Configuration">here</a>.
 The only thing you might want to do differently from that guide is to 
instead of adding two nodes, add one node and one arbiter (using the 
command ‘rs.addArb(“node:port)’).</p>
<p>We also found it handy to set priorities for the two replica nodes. 
We can do this by simply bumping the node we prefer to be the primary to
 ’2′ using the following commands:</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">cfg = rs.conf<span style="color: #7a0874; font-weight: bold;">(</span><span style="color: #7a0874; font-weight: bold;">)</span>
cfg.members<span style="color: #7a0874; font-weight: bold;">[</span><span style="color: #000000;">0</span><span style="color: #7a0874; font-weight: bold;">]</span>.priority = <span style="color: #000000;">2</span>
rs.reconfig<span style="color: #7a0874; font-weight: bold;">(</span>cfg<span style="color: #7a0874; font-weight: bold;">)</span></pre></div></div>

<p>Please note that cfg.member[N] is the list item from the top (the first one being 0). It’s <strong>not</strong> the id. More information is available <a href="http://www.mongodb.org/display/DOCS/Reconfiguring+when+Members+are+Up">here</a>.</p>
<p>In case you need to take down the primary server for maintenance, you
 should use the StepDown-command. This will gracefully force the primary
 server to step down. To do this, log into the server and issue the 
following command:</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">use admin
rs.stepDown<span style="color: #7a0874; font-weight: bold;">(</span><span style="color: #7a0874; font-weight: bold;">)</span></pre></div></div>

<p>Once you’ve validated that the server is ‘secondary’ you can shut the server down without worrying about dataloss.</p>
<p>There are two other commands that you should also be aware about. The first command is:</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">rs.status<span style="color: #7a0874; font-weight: bold;">(</span><span style="color: #7a0874; font-weight: bold;">)</span></pre></div></div>

<p>This command gives you information about your replica set and replication. </p>
<p>The second dommand is:</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">db.serverStatus<span style="color: #7a0874; font-weight: bold;">(</span><span style="color: #7a0874; font-weight: bold;">)</span></pre></div></div>

<p>This will give you detailed information about the individual node.</p>
<h2>Let the sharding begin</h2>
<p>Sharding is a bit more tricky than setting up a simple replica set, 
but a lot easier than sharding a sequel database. While it is not 
necessary that each member of a shard is a replica set, it is highly 
recommended for redundancy purposes. Hence, the way you should be 
thinking about sharding in MongoDB as a way to consolidate multiple 
replica sets. </p>
<p>Here’s an illustration of how one would expand the replica set we described above with a shard.<br>
<img alt="" src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/shard.png" title="Sharded" class="aligncenter"></p>
<p>Let’s now assume that you have two replica sets configured and ready to go. How do you turn them into a shard?</p>
<p>The first thing you will need is to set up config-servers and 
mongos-nodes. The config-servers holds critical data about your 
shard(s). If that data gets lost, you’re basically toast. Hence, you 
want at least three of these servers. Mongos is the router that all your
 nodes will communicate against. The clients won’t be able to tell the 
difference if they are talking to a mongos or a regular replica set, 
which is nice. </p>
<p>You will also need to restart mongod with a few new flags. </p>
<p>To spin up a regular mongod-node (primary or secondary), use this command (assuming the replica set name is ‘repl0′:</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #c20cb9; font-weight: bold;">sudo</span> <span style="color: #660033;">-u</span> mongodb mongod <span style="color: #660033;">--shardsvr</span> <span style="color: #660033;">--replSet</span> repl0 <span style="color: #660033;">--dbpath</span> <span style="color: #000000; font-weight: bold;">/</span>mongo<span style="color: #000000; font-weight: bold;">/</span>repl0 <span style="color: #660033;">--fork</span> <span style="color: #660033;">--logpath</span> <span style="color: #000000; font-weight: bold;">/</span>var<span style="color: #000000; font-weight: bold;">/</span>log<span style="color: #000000; font-weight: bold;">/</span>mongodb<span style="color: #000000; font-weight: bold;">/</span>repl0.log</pre></div></div>

<p>To spin up a config-server, use the following command (note oplogsize is set to 1 to minimize disk space being wasted):</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #c20cb9; font-weight: bold;">sudo</span> <span style="color: #660033;">-u</span> mongodb mongod <span style="color: #660033;">--configsvr</span> <span style="color: #660033;">--dbpath</span> <span style="color: #000000; font-weight: bold;">/</span>mongo<span style="color: #000000; font-weight: bold;">/</span>configsvr <span style="color: #660033;">--fork</span> -–oplogSize <span style="color: #000000;">1</span> <span style="color: #660033;">--logpath</span> <span style="color: #000000; font-weight: bold;">/</span>var<span style="color: #000000; font-weight: bold;">/</span>log<span style="color: #000000; font-weight: bold;">/</span>mongodb<span style="color: #000000; font-weight: bold;">/</span>configsvr.log</pre></div></div>

<p>Finally, you need to spin up the mongos (we assume node1, node2, node 4 and node5 are the config-servers):</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #c20cb9; font-weight: bold;">sudo</span> <span style="color: #660033;">-u</span> mongodb mongos <span style="color: #660033;">--configdb</span> <span style="color: #000000; font-weight: bold;">&lt;</span>node1<span style="color: #000000; font-weight: bold;">&gt;</span>:<span style="color: #000000; font-weight: bold;">&lt;</span>port<span style="color: #000000; font-weight: bold;">&gt;</span>,<span style="color: #000000; font-weight: bold;">&lt;</span>node2<span style="color: #000000; font-weight: bold;">&gt;</span>:<span style="color: #000000; font-weight: bold;">&lt;</span>port<span style="color: #000000; font-weight: bold;">&gt;</span>,<span style="color: #000000; font-weight: bold;">&lt;</span>node4<span style="color: #000000; font-weight: bold;">&gt;</span>:<span style="color: #000000; font-weight: bold;">&lt;</span>port<span style="color: #000000; font-weight: bold;">&gt;</span>,<span style="color: #000000; font-weight: bold;">&lt;</span>node5<span style="color: #000000; font-weight: bold;">&gt;</span>:<span style="color: #000000; font-weight: bold;">&lt;</span>port<span style="color: #000000; font-weight: bold;">&gt;</span> <span style="color: #660033;">--fork</span> <span style="color: #660033;">--logpath</span> <span style="color: #000000; font-weight: bold;">/</span>var<span style="color: #000000; font-weight: bold;">/</span>log<span style="color: #000000; font-weight: bold;">/</span>mongodb<span style="color: #000000; font-weight: bold;">/</span>mongos.log</pre></div></div>

<p>Once you have all the servers up and running, it’s time to start sharding. </p>
<p>Start by opening a mongo-session against one of the mongos-servers. Now we need to add the replica sets to the the shard:</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">use admin
db.runCommand<span style="color: #7a0874; font-weight: bold;">(</span> <span style="color: #7a0874; font-weight: bold;">{</span> addshard : <span style="color: #ff0000;">"repl0/&lt;node1&gt;:&lt;port&gt;,&lt;node2&gt;:&lt;port&gt;,&lt;node3&gt;:&lt;port&gt;"</span>, maxSize:<span style="color: #000000;">10000</span><span style="color: #000000; font-weight: bold;">/*</span>MB<span style="color: #000000; font-weight: bold;">*/</span> <span style="color: #7a0874; font-weight: bold;">}</span> <span style="color: #7a0874; font-weight: bold;">)</span>;
db.runCommand<span style="color: #7a0874; font-weight: bold;">(</span> <span style="color: #7a0874; font-weight: bold;">{</span> addshard : <span style="color: #ff0000;">"repl1/&lt;node4&gt;:&lt;port&gt;,&lt;node5&gt;:&lt;port&gt;,&lt;node6&gt;:&lt;port&gt;"</span>, maxSize:<span style="color: #000000;">10000</span><span style="color: #000000; font-weight: bold;">/*</span>MB<span style="color: #000000; font-weight: bold;">*/</span> <span style="color: #7a0874; font-weight: bold;">}</span> <span style="color: #7a0874; font-weight: bold;">)</span>;</pre></div></div>

<p>The should add both replica sets to the shard. We also specified that
 the maximum storage each replica set should hold to 10GB. Please note 
that this is a soft limit, and the balancer will use this as a guideline
 to evenly spread the data.</p>
<p>Now we have prepared everything that needed preparation. Now it’s 
time to actually shard the data. Let’s assume that we have a 
collection/database named MyStuff that we want to shard. Let’s also 
assume that this is primarily used for GridFS. </p>
<p>Once again, log into mongos, but now run the following commands:</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">use admin
db.runCommand<span style="color: #7a0874; font-weight: bold;">(</span> <span style="color: #7a0874; font-weight: bold;">{</span> enablesharding : <span style="color: #ff0000;">"MyStuff"</span> <span style="color: #7a0874; font-weight: bold;">}</span> <span style="color: #7a0874; font-weight: bold;">)</span>;</pre></div></div>

<p>Next we need to tell Mongo how to shard the data. Let’s use the files_id:</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">use MyStuff
db.fs.chunks.ensureIndex<span style="color: #7a0874; font-weight: bold;">(</span> <span style="color: #7a0874; font-weight: bold;">{</span> files_id: <span style="color: #000000;">1</span> <span style="color: #7a0874; font-weight: bold;">}</span> <span style="color: #7a0874; font-weight: bold;">)</span>;
db.fs.files.ensureIndex<span style="color: #7a0874; font-weight: bold;">(</span> <span style="color: #7a0874; font-weight: bold;">{</span> files_id: <span style="color: #000000;">1</span> <span style="color: #7a0874; font-weight: bold;">}</span> <span style="color: #7a0874; font-weight: bold;">)</span>;
db.runCommand<span style="color: #7a0874; font-weight: bold;">(</span> <span style="color: #7a0874; font-weight: bold;">{</span> shardcollection : <span style="color: #ff0000;">"db.fs.chunks"</span>, key : <span style="color: #7a0874; font-weight: bold;">{</span> files_id : <span style="color: #000000;">1</span> <span style="color: #7a0874; font-weight: bold;">}</span> <span style="color: #7a0874; font-weight: bold;">}</span> <span style="color: #7a0874; font-weight: bold;">)</span>
db.runCommand<span style="color: #7a0874; font-weight: bold;">(</span> <span style="color: #7a0874; font-weight: bold;">{</span> shardcollection : <span style="color: #ff0000;">"db.files.chunks"</span>, key : <span style="color: #7a0874; font-weight: bold;">{</span> files_id : <span style="color: #000000;">1</span> <span style="color: #7a0874; font-weight: bold;">}</span> <span style="color: #7a0874; font-weight: bold;">}</span> <span style="color: #7a0874; font-weight: bold;">)</span></pre></div></div>

<p>Depending on your load, using files_id can be a bad idea as won’t 
evenly distribute the load across the nodes. However, this is a whole 
different topic. </p>
<p>Once you got everything setup, you might want to know more about how 
your system. There are a few commands that will give you a good overview
 about your system (in addition to the ones mentioned above). </p>
<p>To get more information about your system, you  might find the following commands useful:</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">db.printShardingStatus<span style="color: #7a0874; font-weight: bold;">(</span><span style="color: #7a0874; font-weight: bold;">)</span>
db.runCommand<span style="color: #7a0874; font-weight: bold;">(</span> <span style="color: #7a0874; font-weight: bold;">{</span> listShards : <span style="color: #000000;">1</span><span style="color: #7a0874; font-weight: bold;">}</span> <span style="color: #7a0874; font-weight: bold;">)</span>;</pre></div></div>

<p>Another useful command, if you need to reorganize your setup, is removeshard:</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">db.runCommand<span style="color: #7a0874; font-weight: bold;">(</span> <span style="color: #7a0874; font-weight: bold;">{</span> removeshard : <span style="color: #ff0000;">"repl0"</span> <span style="color: #7a0874; font-weight: bold;">}</span> <span style="color: #7a0874; font-weight: bold;">)</span>;</pre></div></div>

<p>It’s likely that you want to learn more about MongoDB before you get started. I would then recommend the following resource:</p>
<ul>
<li><a href="http://www.mongodb.org/display/DOCS/Sharding+Introduction">Sharding Introduction</a></li>
<li><a href="http://www.mongodb.org/display/DOCS/Configuring+Sharding">Configuring Sharding</a></li>
<li><a href="http://www.mongodb.org/display/DOCS/Choosing+a+Shard+Key">Choosing a Shard Key</a></li>
<li><a href="http://www.snailinaturtleneck.com/blog/2011/01/04/how-to-choose-a-shard-key-the-card-game/">How to Choose a Shard Key: The Card Game</a></li>
</ul>
<p>Please note that I’m by no means a MongoDB guru, but feel free to drop a comment below, and I’ll try to answer.</p>
<div class="bottomcontainerBox" style="">
			<div style="float:left; width:85px;padding-right:10px; margin:4px 4px 4px 4px;height:30px;">
			<iframe src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/like.htm" allowtransparency="true" style="border: medium none; overflow: hidden; width: 85px; height: 21px;" frameborder="0" scrolling="no"></iframe></div>
			<div style="float:left; width:85px;padding-right:10px; margin:4px 4px 4px 4px;height:30px;">
			<div style="height: 20px; width: 90px; display: inline-block; text-indent: 0pt; margin: 0pt; padding: 0pt; background: none repeat scroll 0% 0% transparent; border-style: none; float: none; line-height: normal; font-size: 1px; vertical-align: baseline;" id="___plusone_0"><iframe title="+1" allowtransparency="true" hspace="0" marginheight="0" marginwidth="0" style="position: static; top: 0pt; width: 90px; margin: 0px; border-style: none; height: 20px; left: 0pt; visibility: visible;" tabindex="0" vspace="0" id="I1_1336809980451" name="I1_1336809980451" src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/fastbutton.htm" frameborder="0" scrolling="no" width="100%"></iframe></div>
			</div>
			<div style="float:left; width:85px;padding-right:10px; margin:4px 4px 4px 4px;height:30px;">
			<iframe title="Twitter Tweet Button" style="width: 109px; height: 20px;" class="twitter-share-button twitter-count-horizontal" src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/tweet_button.htm" allowtransparency="true" frameborder="0" scrolling="no"></iframe>
			</div><div style="float:left; width:105px;padding-right:10px; margin:4px 4px 4px 4px;height:30px;"><span class="IN-widget" style="line-height: 1; vertical-align: baseline; display: inline-block; text-align: center;"><span style="padding: 0pt ! important; margin: 0pt ! important; text-indent: 0pt ! important; display: inline-block ! important; vertical-align: baseline ! important; font-size: 1px ! important;"><span id="li_ui_li_gen_1336809981509_0"><a id="li_ui_li_gen_1336809981509_0-link" href="javascript:void(0);"><span id="li_ui_li_gen_1336809981509_0-logo">in</span><span id="li_ui_li_gen_1336809981509_0-title"><span id="li_ui_li_gen_1336809981509_0-mark"></span><span id="li_ui_li_gen_1336809981509_0-title-text">Share</span></span></a></span></span><span style="padding: 0pt ! important; margin: 0pt ! important; text-indent: 0pt ! important; display: inline-block ! important; vertical-align: baseline ! important; font-size: 1px ! important;"><span id="li_ui_li_gen_1336809981531_1-container" class="IN-right"><span id="li_ui_li_gen_1336809981531_1" class="IN-right"><span id="li_ui_li_gen_1336809981531_1-inner" class="IN-right"><span id="li_ui_li_gen_1336809981531_1-content" class="IN-right">12</span></span></span></span></span></span><script type="in/share+init" data-url="http://viktorpetersson.com/2012/01/29/notes-on-mongodb-gridfs-and-sharding-in-the-cloud/" data-counter="right"></script></div><div style="float:left; width:105px;padding-right:10px; margin:4px 4px 4px 4px;height:30px;"><a href="http://pinterest.com/pin/create/button/?url=http://viktorpetersson.com/2012/01/29/notes-on-mongodb-gridfs-and-sharding-in-the-cloud/&amp;media=http://viktorpetersson.com/upload/primary_secondary_arbiter.png" class="pin-it-button" count-layout="horizontal"></a></div>			
			</div><div style="clear:both"></div><div style="padding-bottom:4px;"></div>								
															
							</div>
						
							<div class="postmetadata">Tags: <a href="http://viktorpetersson.com/tag/mongodb/" rel="tag">MongoDB</a><br></div>
									
							<div class="postmetadata alt">
								<small>
									This entry was posted
																		on Sunday, January 29th, 2012 at 5:24 am									and is filed under <a href="http://viktorpetersson.com/category/howto/" title="View all posts in Howto" rel="category tag">Howto</a>.
									You can follow any responses to this entry through the <a href="http://viktorpetersson.com/2012/01/29/notes-on-mongodb-gridfs-and-sharding-in-the-cloud/feed/">RSS 2.0</a> feed.
																			You can <a href="#respond">leave a response</a>, or <a href="http://viktorpetersson.com/2012/01/29/notes-on-mongodb-gridfs-and-sharding-in-the-cloud/trackback/" rel="trackback">trackback</a> from your own site.
																	</small>
							</div>
	
							
<div id="disqus_thread"><div class="clearfix" style="display: block;" id="dsq-content">      <div id="dsq-global-toolbar" class="dsq-clearfix">        <ul class="dsq-global-toolbar-right dsq-clearfix">                            <li class="dsq-community-box">                <a href="#" class="dsq-toolbar-item dsq-tt" onclick="DISQUS.dtpl.actions.fire('community.show'); return false" title="Expand Community Box"><span class="dsq-toolbar-icon"></span></a>            </li>                            <li class="dsq-global-toolbar-dropdown-container">                    <div id="dsq-toolbar-dropdown">    <a href="#" class="dsq-toolbar-logo dsq-toolbar-item dsq-clearfix"><span class="dsq-toolbar-icon">Disqus</span></a>    <div id="dsq-toolbar-dropdown-wrap" style="display: none">      <ul class="dsq-clearfix">                    <li class="dsq-login-link"><a href="#" onclick="DISQUS.dtpl.actions.fire('auth.login'); return false"><span class="dsq-toolbar-icon"></span><span class="dsq-toolbar-label">Login</span></a></li>                    <li class="dsq-about-link"><a href="http://disqus.com/" target="_blank"><span class="dsq-toolbar-icon"></span><span class="dsq-toolbar-label">About Disqus</span></a></li>      </ul>    </div>  </div>            </li>        </ul>                <ul class="dsq-global-toolbar-left dsq-clearfix">            <li class="dsq-like-thread">                <a href="#" id="dsq-like-thread-button" class="dsq-toolbar-item dsq-clearfix  dsq-tt" onclick="DISQUS.dtpl.actions.fire('thread.vote', 1); return false;" title="I like this page">                    <span class="dsq-toolbar-icon"></span>                    <span class="dsq-toolbar-label">Like</span>                </a>            </li>            <li class="dsq-dislike-thread">                <a href="#" id="dsq-dislike-thread-button" class="dsq-toolbar-item dsq-clearfix  dsq-tt" onclick="DISQUS.dtpl.actions.fire('thread.vote', -1); return false" title="I don't like this page">                    <span class="dsq-toolbar-icon">Dislike</span>                </a>            </li>            <li class="dsq-like-panel">                <ul class="dsq-like-faces dsq-clearfix">                          <li class="dsq-tt" title="Mikhail Kashkin"><a href="http://disqus.com/mkashkin/" onclick="return DISQUS.dtpl.actions.fire('profile.show', null, 'mkashkin', false); return false"><img src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/avatar32.jpg"></a></li>    <li class="dsq-like-activity">                  and 2 others liked this.          </li>                </ul>            </li>        </ul>            </div>    <div id="dsq-like-tooltip">      <div id="dsq-share-step-1" class="dsq-share-step">        <h3>Glad you liked it. Would you like to share?</h3>        <p class="dsq-tooltip-checkbox"><input id="dsq-share-thread-facebook" value="Facebook" type="checkbox"><label for="dsq-share-thread-facebook"><span class="dsq-facebook">Facebook</span></label></p>        <p class="dsq-tooltip-checkbox"><input id="dsq-share-thread-twitter" value="Twitter" type="checkbox"><label for="dsq-share-thread-twitter"><span class="dsq-twitter">Twitter</span></label></p>        <ul id="dsq-tooltip-actions">                        <li><a href="#" onclick="DISQUS.dtpl.actions.fire('thread.share.send'); return false" class="dsq-primary-action">Share</a></li>                    <li><a href="#" onclick="DISQUS.dtpl.actions.fire('thread.share.cancel'); return false" class="dsq-secondary-action">No thanks</a></li>        </ul>      </div>      <div id="dsq-share-step-2" class="dsq-share-step" style="display:none !important">        <p>Sharing this page …</p>      </div>      <div id="dsq-share-step-3" class="dsq-share-step" style="display:none !important">        <p>Thanks! <a href="#" class="dsq-tooltip-decline" onclick="DISQUS.dtpl.actions.fire('thread.share.cancel'); return false">Close</a></p>      </div>    </div>                                <div class="dsq-reply " id="dsq-reply">          <div id="dsq-account-dropdown">                  <a href="#" onclick="DISQUS.dtpl.actions.fire('auth.login'); return false;">Login</a>              </div>      <h3>Add New Comment</h3>        <div class="dsq-avatar">              <img src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/noavatar32.png">          </div>    <div class="dsq-textarea dsq-textarea-reply">      <div class="dsq-textarea-background">        <div style="height: auto;" class="dsq-textarea-wrapper">          <!-- filled dynamically -->        <iframe style="height: 58px;" src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/reply.htm" id="easyXDM_DISQUS_net_default3283_provider" name="easyXDM_DISQUS_net_default3283_provider" frameborder="0" scrolling="no"></iframe></div>                  <div id="dsq-media-preview" class="dsq-media-preview" style="display:none">          </div>                <div class="dsq-post-tools">          <ul>            <li class="dsq-post-as">                                <button type="button" class="dsq-button" onclick="DISQUS.dtpl.actions.fire('comments.validate', null, this);">                    Post as …                  </button>                          </li>                          <li class="dsq-attach-media">                <div class="dsq-attach-media-container">                  <span>Image</span>                  <!-- filled dynamically -->                <iframe src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/upload.htm" id="easyXDM_DISQUS_net_default3284_provider" name="easyXDM_DISQUS_net_default3284_provider" frameborder="0" scrolling="no"></iframe></div>              </li>                        <li class="dsq-share-on dsq-clearfix">                            </li>          </ul>        </div>      </div>    </div>  </div>                              <div id="dsq-sort-by">    <select id="dsq-sort-select" onchange="DISQUS.dtpl.actions.fire('thread.sort', this.value);">              <option value="hot" selected="selected">          Sort by popular now        </option>              <option value="best">          Sort by best rating        </option>              <option value="newest">          Sort by newest first        </option>              <option value="oldest">          Sort by oldest first        </option>          </select>  </div>      <h3>            Showing <span id="dsq-num-posts">2</span> comments        </h3>        <ul id="dsq-comments">            <li id="comment-423813964">  </li><li id="dsq-comment-423813964" data-dsq-comment-id="423813964" class="dsq-comment dsq-clearfix        dsq-comment-is-parent                " style="margin-left:0px;">    <div original-title="Expand Scott Hernandez's profile" class="dsq-avatar dsq-tt">      <a href="http://disqus.com/scotthernandez/" onclick="DISQUS.dtpl.actions.fire('profile.show', 423813964, null); return false">        <img src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/avatar32_003.jpg" class="" alt="">      </a>    </div>    <div id="dsq-comment-body-423813964" class="dsq-comment-body">      <div class="dsq-comment-header">        <a href="http://flickr.com/photos/scotthernandez" target="_blank" class="dsq-commenter-name" rel="nofollow">Scott Hernandez</a><span class="dsq-commenter-bio">, I live</span>                <span class="dsq-collapsed-count">                      2 comments collapsed                  </span>                <a href="#" class="dsq-collapse-toggle dsq-collapse" title="Collapse thread" onclick="DISQUS.dtpl.actions.fire('comments.collapse', 423813964); return false;"><span>Collapse</span></a>        <a href="#" class="dsq-collapse-toggle dsq-expand" title="Expand thread" onclick="DISQUS.dtpl.actions.fire('comments.expand', 423813964); return false;"><span>Expand</span></a>      </div>        <div class="dsq-comment-message" id="dsq-comment-message-423813964">                <div class="dsq-comment-text" id="dsq-comment-text-423813964">        <p>The
 only issue with sharding on gridfs with a shard-key which is files_id 
is if you have files larger than the default sharding chunk size 
(64MB).&nbsp;If you have files larger than that you can get some errors 
or warnings and in earlier versions (pre 2.0.3/2.1.0) it would stop 
balancing.</p>

<p>They should increase the setting for the chunkSize option if they are
 storing large files. That may impact performance and the migration time
 per chunk, depending on the speed of disk and how often migrations 
happen.</p>      </div>                        </div>            <!-- edit box dynamically inserted here -->      <div id="dsq-append-edit-423813964"></div>        <div class="dsq-comment-footer">    <ul class="dsq-comment-actions">              <li id="dsq-like-423813964">          <span class="dsq-like-thumb dsq-font">A</span>          <a href="#" onclick="DISQUS.dtpl.actions.fire('comments.like', this,423813964); return false">Like</a>        </li>                          <li>          <a href="#" class="dsq-comment-reply" onclick="DISQUS.dtpl.actions.fire('comments.reply',423813964, this); return false">Reply</a>        </li>         </ul>    <ul class="dsq-comment-meta">      <li>  <a href="#comment-423813964" onclick="DISQUS.dtpl.actions.fire('comments.permalink', 423813964);" title="Link to comment by Scott Hernandez">          3 months ago      </a></li>            <li style="display:none">          <a href="#" id="dsq-comment-like-count-423813964" class="dsq-comment-like-count" onclick="return DISQUS.dtpl.actions.fire('comments.showUserVotes', 423813964); return false">0          Like      </a>      </li>              <li class="dsq-comment-flag" style="visibility: hidden">          <a href="#" class="dsq-comment-flag dsq-font" onclick="return DISQUS.dtpl.actions.fire('comments.report', 423813964, false);">F</a>        </li>          </ul>  </div>      <!-- reply box dynamically inserted here -->      <div id="dsq-append-reply-423813964"></div>    </div>  </li>  <!-- new replies dynamically inserted here -->  <li id="dsq-append-post-423813964"></li>            <li id="comment-423838844">  </li><li id="dsq-comment-423838844" data-dsq-comment-id="423838844" class="dsq-comment dsq-clearfix                dsq-moderator        dsq-founder" style="margin-left:46px;">    <div class="dsq-avatar dsq-tt" title="Expand vpetersson's profile">      <a href="http://disqus.com/vpetersson/" onclick="DISQUS.dtpl.actions.fire('profile.show', 423838844, null); return false">        <img src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/avatar32_002.jpg" class="" alt="">      </a>    </div>    <div id="dsq-comment-body-423838844" class="dsq-comment-body">      <div class="dsq-comment-header">        <span class="dsq-commenter-name">vpetersson</span>                <span class="dsq-collapsed-count">                      1 comment collapsed                  </span>                <a href="#" class="dsq-collapse-toggle dsq-collapse" title="Collapse thread" onclick="DISQUS.dtpl.actions.fire('comments.collapse', 423838844); return false;"><span>Collapse</span></a>        <a href="#" class="dsq-collapse-toggle dsq-expand" title="Expand thread" onclick="DISQUS.dtpl.actions.fire('comments.expand', 423838844); return false;"><span>Expand</span></a>      </div>        <div class="dsq-comment-message" id="dsq-comment-message-423838844">                <div class="dsq-comment-text" id="dsq-comment-text-423838844">        <p>Interesting. I didn't know that. Thanks.</p>      </div>                        </div>            <!-- edit box dynamically inserted here -->      <div id="dsq-append-edit-423838844"></div>        <div class="dsq-comment-footer">    <ul class="dsq-comment-actions">              <li id="dsq-like-423838844">          <span class="dsq-like-thumb dsq-font">A</span>          <a href="#" onclick="DISQUS.dtpl.actions.fire('comments.like', this,423838844); return false">Like</a>        </li>                          <li>          <a href="#" class="dsq-comment-reply" onclick="DISQUS.dtpl.actions.fire('comments.reply',423838844, this); return false">Reply</a>        </li>         </ul>    <ul class="dsq-comment-meta">      <li>  <a href="#comment-423838844" onclick="DISQUS.dtpl.actions.fire('comments.permalink', 423838844);" title="Link to comment by vpetersson">          3 months ago      </a></li>              <li>          <a onclick="DISQUS.dtpl.actions.fire('comments.showParent', 423813964); return false" href="#comment-423813964" title="Jump to comment">            in reply to Scott Hernandez          </a>        </li>            <li style="display:none">          <a href="#" id="dsq-comment-like-count-423838844" class="dsq-comment-like-count" onclick="return DISQUS.dtpl.actions.fire('comments.showUserVotes', 423838844); return false">0          Like      </a>      </li>              <li class="dsq-comment-flag" style="visibility: hidden">          <a href="#" class="dsq-comment-flag dsq-font" onclick="return DISQUS.dtpl.actions.fire('comments.report', 423838844, false);">F</a>        </li>          </ul>  </div>      <!-- reply box dynamically inserted here -->      <div id="dsq-append-reply-423838844"></div>    </div>  </li>  <!-- new replies dynamically inserted here -->  <li id="dsq-append-post-423838844"></li>      </ul>        <div id="dsq-pagination">      <ul id="dsq-footer" class="dsq-clearfix">        <div id="dsq-subscribe">            <li>      <a href="#" class="dsq-subscribe-email" onclick="return DISQUS.dtpl.actions.fire('thread.subscribe');">        <span class="dsq-font">M</span> <em>Subscribe by email</em>      </a>    </li>    <li>    <a href="http://viktorpeterssoncom.disqus.com/notes_on_mongodb_gridfs_sharding_and_deploying_in_the_cloud/latest.rss" class="dsq-subscribe-rss">      <span class="dsq-font">S</span> <em>RSS</em>    </a>  </li>    </div>  </ul>    </div>                    <h3>Trackbacks</h3>        <div class="dsq-trackback-url">      Trackback URL      <input onclick="this.select()" readonly="true" value="http://viktorpetersson.com/2012/01/29/notes-on-mongodb-gridfs-and-sharding-in-the-cloud/trackback/">    </div>          <ul>                  <li>            <cite>              <a href="http://www.programsolution.info/mongodb-replica-sets-and-sharding-for-gridfs-as-a-distributed.html" rel="nofollow">MongoDB Replica Sets and Sharding for GridFS as a Distributed … | Programmer Solution</a>            </cite>            <p class="dsq-trackback-date">01/30/2012 05:38 AM</p>            <p class="dsq-trackback-excerpt">[...] via: http://viktorpetersson.com/2012/01/29/notes-on-mongodb-gridfs-and-sharding-in-the-cloud/ [...] </p>          </li>                  <li>            <cite>              <a href="http://viktorpetersson.com/2012/02/13/comparing-mongodb-write-performance-on-centos-freebsd-and-ubuntu/" rel="nofollow">Comparing MongoDB write-performance on CentOS, FreeBSD and Ubuntu | Viktor Petersson.com</a>            </cite>            <p class="dsq-trackback-date">02/13/2012 12:20 PM</p>            <p class="dsq-trackback-excerpt">[...] I wrote a post titled ‘Notes on MongoDB, GridFS, sharding and deploying in the cloud.’ I talked about various ...</p>          </li>              </ul>      </div><div class=" fb_reset" id="fb-root"><div style="position: absolute; top: -10000px; height: 0pt; width: 0pt;"><div></div><div><iframe src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/xd_arbiter.htm" name="fb_xdm_frame_http" id="fb_xdm_frame_http"></iframe><iframe src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/xd_arbiter_002.htm" name="fb_xdm_frame_https" id="fb_xdm_frame_https"></iframe></div><div><iframe src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/oauth.htm" class="FB_UI_Hidden" style="border: medium none; overflow: hidden; height: 240px; width: 575px;" name="f196b1a21df3ba4" id="fe16a4b0fc352" scrolling="no"></iframe></div></div></div><div>  </div></div>

<script type="text/javascript">
/* <![CDATA[ */
    var disqus_url = 'http://viktorpetersson.com/2012/01/29/notes-on-mongodb-gridfs-and-sharding-in-the-cloud/';
    var disqus_identifier = '1154 http://viktorpetersson.com/?p=1154';
    var disqus_container_id = 'disqus_thread';
    var disqus_domain = 'disqus.com';
    var disqus_shortname = 'viktorpeterssoncom';
    var disqus_title = "Notes on MongoDB, GridFS, sharding  and deploying in the cloud";
        var disqus_config = function () {
        var config = this; // Access to the config object

        /*
           All currently supported events:
            * preData — fires just before we request for initial data
            * preInit - fires after we get initial data but before we load any dependencies
            * onInit  - fires when all dependencies are resolved but before dtpl template is rendered
            * afterRender - fires when template is rendered but before we show it
            * onReady - everything is done
         */

        config.callbacks.preData.push(function() {
            // clear out the container (its filled for SEO/legacy purposes)
            document.getElementById(disqus_container_id).innerHTML = '';
        });
                config.callbacks.onReady.push(function() {
            // sync comments in the background so we don't block the page
            DISQUS.request.get('?cf_action=sync_comments&post_id=1154');
        });
                    };
    var facebookXdReceiverPath = 'http://viktorpetersson.com/wp-content/plugins/disqus-comment-system/xd_receiver.htm';
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
    var DsqLocal = {
        'trackbacks': [
            {
                'author_name':    "MongoDB Replica Sets and Sharding for GridFS as a Distributed &#8230; | Programmer Solution",
                'author_url':    "http:\/\/www.programsolution.info\/mongodb-replica-sets-and-sharding-for-gridfs-as-a-distributed.html",
                'date':            "01\/30\/2012 05:38 AM",
                'excerpt':        "[...] via: http:\/\/viktorpetersson.com\/2012\/01\/29\/notes-on-mongodb-gridfs-and-sharding-in-the-cloud\/ [...] ",
                'type':            "pingback"            }
,            {
                'author_name':    "Comparing MongoDB write-performance on CentOS, FreeBSD and Ubuntu | Viktor Petersson.com",
                'author_url':    "http:\/\/viktorpetersson.com\/2012\/02\/13\/comparing-mongodb-write-performance-on-centos-freebsd-and-ubuntu\/",
                'date':            "02\/13\/2012 12:20 PM",
                'excerpt':        "[...] I wrote a post titled &#8216;Notes on MongoDB, GridFS, sharding and deploying in the cloud.&#8217; I talked about various ...",
                'type':            "pingback"            }
        ],
        'trackback_url': "http:\/\/viktorpetersson.com\/2012\/01\/29\/notes-on-mongodb-gridfs-and-sharding-in-the-cloud\/trackback\/"    };
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript';
    dsq.async = true;
        dsq.src = 'http' + '://' + disqus_shortname + '.' + disqus_domain + '/embed.js?pname=wordpress&pver=2.72';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
/* ]]> */
</script>
						
						</div>
				
					</div>
				
				
	

					</div>

				</div></div>
				
				<!--footer-->	
				<div class="footer">
					<div class="width">
						
						<div class="corner-left"><div class="corner-right">
							
							<div class="indent">
								© Viktor Petersson. Part of the <a href="http://vikpire.com/">Vikpire</a>.
							</div>
							
						</div></div>
					</div>
				</div>
				<!--footer-->	
				
			</div>
		</div>
			
	</div>
	
				<script type="text/javascript">
				(function($){
					$(function(){
						$("img.flickr.square,img.flickr.thumbnail,img.flickr.small").flightbox({size_callback: get_sizes});
					});
				})(jQuery);
			</script>
		<script type="text/javascript" src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/jquery_003.js"></script>
<script type="text/javascript" src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/jquery_004.js"></script>
<script type="text/javascript" src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/jquery_006.js"></script>
<script type="text/javascript" src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/piclens_optimized.js"></script>
<script type="text/javascript" src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/jquery_005.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var _wpcf7 = {"loaderUrl":"http:\/\/viktorpetersson.com\/wp-content\/plugins\/contact-form-7\/images\/ajax-loader.gif","sending":"Sending ...","cached":"1"};
/* ]]> */
</script>
<script type="text/javascript" src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/scripts.js"></script>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script><script src="vpetersson_data/ga.js" type="text/javascript"></script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-12090766-1");
pageTracker._setDomainName("none");
pageTracker._setAllowLinker(true);
pageTracker._trackPageview();
} catch(err) {}
</script>
	


<iframe src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/def.htm" style="position: absolute; top: -2000px; left: 0px;" id="easyXDM_DISQUS_net_default3282_provider" name="easyXDM_DISQUS_net_default3282_provider" frameborder="0"></iframe><script charset="UTF-8" src="Notes%20on%20MongoDB,%20GridFS,%20sharding%20and%20deploying%20in%20the%20cloud%20_%20Viktor%20Petersson.com_files/a.htm"></script><div style="position: absolute; z-index: 9999; visibility: hidden; top: 4366px; left: 368px; display: block; background-position: 18px bottom; opacity: 0.96;" class="dsq-tooltip-outer dsq-tooltip-small"><div class="dsq-tooltip dsq-cleanslate">  <div class="dsq-tooltip-notch"></div>  <div class="dsq-tooltip-inner">Expand Scott Hernandez's profile</div></div></div></body></html>
<!-- Performance optimized by W3 Total Cache. Learn more: http://www.w3-edge.com/wordpress-plugins/

Page Caching using apc
Database Caching 1/32 queries in 0.059 seconds using apc
Object Caching 662/742 objects using apc

Served from: viktorpetersson.* @ 2012-05-11 23:52:12 -->